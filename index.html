<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>BF6 Ranked System</title>

<style>
  /* ====== CINEMATIC OVERLAY ====== */
.cinematic{
  position: fixed;
  inset: 0;
  z-index: 9999;
  display:flex;
  align-items:center;
  justify-content:center;

    --cin-intensity: 1;          /* 1..10 */
  --cin-burst: 0.25;           /* 0..1 */
  --cin-shake: 0px;            /* px */
  --cin-ring-speed: 2.2s;      /* time */
  --cin-particles: 18;         /* count */
  --cin-duration: 2400ms;      /* auto-hide */

}

.cinematic.hidden{ display:none; }

.cinematic-bg{
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 30% 30%, rgba(34,211,238,0.18), transparent 55%),
    radial-gradient(circle at 70% 70%, rgba(167,139,250,0.12), transparent 60%),
    radial-gradient(circle at 50% 50%, rgba(0,0,0,0.85), rgba(0,0,0,0.95));
  backdrop-filter: blur(8px);
  animation: cinFade 0.35s ease;
}
  /* Epic burst layer (scales with intensity) */
.cinematic-bg::after{
  content:"";
  position:absolute;
  inset:-40%;
  background:
    radial-gradient(circle at 50% 45%,
      color-mix(in srgb, var(--cin-accent, #22d3ee) 55%, transparent) 0%,
      transparent 60%
    ),
    radial-gradient(circle at 50% 55%,
      color-mix(in srgb, var(--cin-accent, #22d3ee) 35%, transparent) 0%,
      transparent 70%
    );
  opacity: var(--cin-burst, 0.25);
  filter: blur(2px);
  transform: scale(calc(0.92 + (var(--cin-intensity, 1) * 0.012)));
  pointer-events:none;
  animation: cinBurstPulse 520ms ease;
}

@keyframes cinBurstPulse{
  0%{ opacity: 0; transform: scale(0.90); }
  45%{ opacity: var(--cin-burst, 0.25); transform: scale(1.03); }
  100%{ opacity: calc(var(--cin-burst, 0.25) * 0.55); transform: scale(1.00); }
}


@keyframes cinFade{
  from { opacity:0; }
  to { opacity:1; }
}

.cinematic-card{
  position:relative;
  width:min(720px, 92vw);
  padding: 34px 28px;
  border-radius: 22px;
  background: linear-gradient(135deg, rgba(2,6,23,0.85), rgba(15,23,42,0.85));
  border: 1px solid rgba(255,255,255,0.07);
    box-shadow: 0 0 calc(60px + (var(--cin-intensity, 1) * 10px))
    color-mix(in srgb, var(--cin-accent, #22d3ee) 18%, rgba(0,0,0,0));
  overflow:hidden;
  transform: translateZ(0);
}
  
  .cin-wrap{
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
  /* Shake helper (intensity-controlled) */
.cinematic[data-shake="1"] .cin-wrap{
  animation: cinShake 420ms ease;
}

@keyframes cinShake{
  0%{ transform: translateY(0) translateX(0) scale(1); }
  25%{ transform: translateY(0) translateX(calc(var(--cin-shake, 0px) * -1)) scale(1); }
  55%{ transform: translateY(0) translateX(var(--cin-shake, 0px)) scale(1); }
  80%{ transform: translateY(0) translateX(calc(var(--cin-shake, 0px) * -0.5)) scale(1); }
  100%{ transform: translateY(0) translateX(0) scale(1); }
}

.cinematic-card::after{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius: 22px;
  padding: 2px;
  background: linear-gradient(120deg, rgba(34,211,238,0.95), rgba(56,189,248,0.0), rgba(167,139,250,0.75));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  opacity: .55;
  filter: drop-shadow(0 0 20px rgba(34,211,238,0.25));
}

.cinematic-title{
  font-size: 26px;
  font-weight: 900;
  letter-spacing: 1.2px;
  background: linear-gradient(90deg, #22d3ee, #a78bfa);
  -webkit-background-clip:text;
  -webkit-text-fill-color: transparent;
  text-transform: uppercase;
}

.cinematic-sub{
  margin-top: 10px;
  color:#cbd5e1;
  letter-spacing: .6px;
  opacity: .9;
}

.cinematic-emblem{
  margin-top: 22px;
  width: 160px;
  height: 160px;
  position: relative;
}

.cin-ring{
  position:absolute;
  inset:-18px;
  border-radius: 50%;
  background: conic-gradient(from 0deg, transparent, rgba(34,211,238,0.9), transparent, rgba(167,139,250,0.7), transparent);
  animation: spin var(--cin-ring-speed, 2.2s) linear infinite;
  box-shadow: 0 0 30px rgba(34,211,238,0.25);
}

.cin-core{
  position:absolute;
  inset: 24px;
  border-radius: 50%;
    background: radial-gradient(
  circle at 30% 30%,
  color-mix(in srgb, var(--cin-accent, #22d3ee) 55%, white),
  var(--cin-accent, #22d3ee) 45%,
  #020617 72%
);
  box-shadow: 0 0 40px rgba(34,211,238,0.5);
}

.cin-hint{
  margin-top: 18px;
  font-size: 12px;
  color:#9ca3af;
  opacity: .8;
}
  /* ====== CINEMATIC MODES + PARTICLES ====== */
.cinematic{ --cin-accent: #22d3ee; }

.cinematic[data-mode="up"] .cinematic-card{
  box-shadow: 0 0 90px rgba(34,211,238,0.18);
}

.cinematic[data-mode="down"] .cinematic-card{
  box-shadow: 0 0 90px rgba(251,113,133,0.16);
}

/* Background pulse stronger depending on mode */
.cinematic[data-mode="up"] .cinematic-bg{
  animation: cinFade 0.25s ease, bgPulseUp 1.2s ease forwards;
}
@keyframes bgPulseUp{
  0%{ filter: saturate(1) brightness(1); }
  35%{ filter: saturate(1.35) brightness(1.15); }
  100%{ filter: saturate(1.05) brightness(1.02); }
}

.cinematic[data-mode="down"] .cinematic-bg{
  animation: cinFade 0.25s ease, bgPulseDown 1.1s ease forwards;
}
@keyframes bgPulseDown{
  0%{ filter: saturate(1) brightness(1); }
  40%{ filter: saturate(1.2) brightness(0.95); }
  100%{ filter: saturate(1.05) brightness(1.0); }
}

/* Card entrance animation differs */
.cinematic[data-mode="up"] .cinematic-card{
  animation: popUp 520ms cubic-bezier(.2,.9,.2,1);
}
@keyframes popUp{
  0% { transform: translateY(18px) scale(0.96); opacity:0; }
  55%{ transform: translateY(-2px) scale(1.02); opacity:1; }
  100%{ transform: translateY(0) scale(1); opacity:1; }
}

.cinematic[data-mode="down"] .cinematic-card{
  animation: popDown 520ms cubic-bezier(.2,.9,.2,1);
}
@keyframes popDown{
  0% { transform: translateY(-10px) scale(0.98); opacity:0; }
  55%{ transform: translateY(10px) scale(1.00); opacity:1; }
  100%{ transform: translateY(0) scale(1); opacity:1; }
}

/* Emblem ring speed changes */
.cinematic[data-mode="up"] .cin-ring{ animation-duration: 1.6s; }
.cinematic[data-mode="down"] .cin-ring{ animation-duration: 2.6s; opacity: .85; }

/* Demotion adds red flash */
.cinematic[data-mode="down"] .cinematic-card::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius: 22px;
  background: radial-gradient(circle at 50% 35%, rgba(251,113,133,0.20), transparent 60%);
  opacity: .9;
  pointer-events:none;
  animation: redFlash 420ms ease;
}
@keyframes redFlash{
  0%{ opacity:0; transform: scale(0.98); }
  55%{ opacity:1; transform: scale(1.02); }
  100%{ opacity:0.35; transform: scale(1); }
}

/* Particles container */
.cin-particles{
  position:absolute;
  inset:0;
  pointer-events:none;
}

/* Particle */
.cin-particle{
  position:absolute;
  width: 6px;
  height: 6px;
  border-radius: 999px;
  background: var(--cin-accent, rgba(34,211,238,0.95));
  box-shadow: 0 0 18px color-mix(in srgb, var(--cin-accent, #22d3ee) 55%, transparent);
  opacity: 0;
  transform: translate(-50%, -50%) scale(0.6);
  animation: particleFly 850ms ease-out forwards;
}
@keyframes particleFly{
  0%{ opacity: 0; transform: translate(-50%,-50%) scale(0.6); }
  18%{ opacity: 0.95; }
  100%{
    opacity: 0;
    transform:
      translate(calc(-50% + var(--dx)), calc(-50% + var(--dy)))
      scale(0.9);
  }
}


  /* ====== FORM (ADD MATCH) ====== */
.form .grid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
  max-width: 620px;
}

.form label{
  display:flex;
  flex-direction:column;
  gap: 8px;
  font-size: 12px;
  color:#cbd5e1;
  letter-spacing: .3px;
}

.form input[type="number"]{
  padding: 12px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(2,6,23,0.55);
  color:#e5e7eb;
  outline: none;
}

.form input[type="number"]:focus{
  border-color: rgba(34,211,238,0.35);
  box-shadow: 0 0 18px rgba(34,211,238,0.08);
}

.toggles{
  margin-top: 14px;
  display:flex;
  gap: 12px;
  flex-wrap: wrap;
}

.toggle{
  display:flex;
  align-items:center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(2,6,23,0.45);
  color:#e5e7eb;
  font-size: 12px;
}

.toggle input{ transform: scale(1.1); }

.actions{
  margin-top: 16px;
  display:flex;
  align-items:center;
  gap: 10px;
  flex-wrap: wrap;
}

.btn{
  padding: 10px 14px;
  border-radius: 12px;
  border: 1px solid rgba(34,211,238,0.35);
  background: rgba(34,211,238,0.14);
  color:#a5f3fc;
  cursor:pointer;
  font-weight: 700;
  letter-spacing: .3px;
}

.btn:hover{
  background: rgba(34,211,238,0.22);
}

.btn.ghost{
  border-color: rgba(251,113,133,0.35);
  background: rgba(251,113,133,0.10);
  color:#fecdd3;
}

.btn.ghost:hover{
  background: rgba(251,113,133,0.16);
}

.hint{
  font-size: 12px;
  color:#9ca3af;
  opacity: .9;
}

  /* ====== MATCH HISTORY UI ====== */
.history-top{
  margin-top: 22px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  max-width: 900px;
}

.mini-card{
  padding: 14px 16px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(15,23,42,.85), rgba(2,6,23,.9));
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 0 0 24px rgba(34,211,238,0.05);
}

.mini-label{
  font-size: 12px;
  color:#9ca3af;
  letter-spacing: .8px;
}

.mini-value{
  margin-top: 6px;
  font-size: 22px;
  font-weight: 800;
  color:#22d3ee;
  text-shadow: 0 0 10px rgba(34,211,238,0.25);
}

.match-list{
  margin-top: 16px;
  display: grid;
  gap: 12px;
  max-width: 900px;
}

.match-card{
  position: relative;
  padding: 16px 16px;
  border-radius: 16px;
  background: linear-gradient(135deg, rgba(2,6,23,.85), rgba(15,23,42,.85));
  border: 1px solid rgba(255,255,255,0.06);
  overflow: hidden;
  transition: transform .2s ease, border-color .2s ease, box-shadow .2s ease;
}

.match-card:hover{
  transform: translateY(-1px);
  border-color: rgba(34,211,238,0.18);
  box-shadow: 0 0 28px rgba(34,211,238,0.06);
}

.match-card.best{
  border-color: rgba(34,211,238,0.55);
  box-shadow: 0 0 34px rgba(34,211,238,0.10);
}

.match-card.worst{
  border-color: rgba(251,113,133,0.45);
  box-shadow: 0 0 34px rgba(251,113,133,0.08);
}

.match-row{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
}

.left{
  display:flex;
  flex-direction: column;
  gap: 6px;
}

.title{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight: 800;
  letter-spacing: .8px;
}

.place{
  font-size: 12px;
  color:#9ca3af;
}

.kad{
  font-size: 12px;
  color:#9ca3af;
}
  .breakdown{
  margin-top: 10px;
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.06);
  background: rgba(2,6,23,0.42);
}

.break-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  font-size: 12px;
  color:#9ca3af;
  padding: 2px 0;
}

.break-row strong{
  color:#e5e7eb;
  font-weight: 800;
}

.break-row .pos{ color: #22c55e; }
.break-row .neg{ color: #fb7185; }

.break-total{
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px solid rgba(255,255,255,0.06);
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size: 12px;
  letter-spacing: .4px;
}

.break-total span{
  color:#cbd5e1;
  font-weight: 800;
}

.rpDelta{
  font-size: 18px;
  font-weight: 900;
  min-width: 90px;
  text-align: right;
}

.rpPlus{ color:#22c55e; text-shadow: 0 0 12px rgba(34,197,94,0.15); }
.rpMinus{ color:#fb7185; text-shadow: 0 0 12px rgba(251,113,133,0.15); }

.badges{
  display:flex;
  gap:8px;
  flex-wrap: wrap;
}

.badge-pill{
  font-size: 11px;
  letter-spacing: .6px;
  padding: 5px 9px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(2,6,23,0.55);
  color:#e5e7eb;
  opacity: .95;
}

.badge-mvp{
  border-color: rgba(251,191,36,0.35);
  box-shadow: 0 0 14px rgba(251,191,36,0.10);
  color:#fbbf24;
}

.badge-leave{
  border-color: rgba(251,113,133,0.35);
  box-shadow: 0 0 14px rgba(251,113,133,0.10);
  color:#fb7185;
}

  /* ====== RANK LADDER ====== */
.ladder{
  margin-top: 28px;
  max-width: 900px;
}

.ladder-head{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  margin-bottom: 12px;
}

.ladder-head h3{
  font-size: 18px;
  letter-spacing: .6px;
  color:#e5e7eb;
}

.ladder-note{
  font-size: 12px;
  color:#9ca3af;
  opacity:.9;
}

.ladder-list{
  display:grid;
  gap: 10px;
}

.ladder-item{
  position:relative;
  display:flex;
  gap: 14px;
  align-items:center;
  padding: 14px 16px;
  border-radius: 14px;
  background: linear-gradient(180deg, rgba(15,23,42,.9), rgba(2,6,23,.9));
  border: 1px solid rgba(255,255,255,0.06);
  overflow:hidden;
  transition: transform .2s ease, border-color .2s ease, box-shadow .2s ease;
}

.ladder-item:hover{
  transform: translateY(-1px);
  border-color: rgba(34,211,238,0.18);
  box-shadow: 0 0 26px rgba(34,211,238,0.06);
}

.ladder-item.locked{
  opacity: .35;
  filter: grayscale(0.35);
}

.ladder-item.unlocked{
  opacity: 1;
}

.ladder-item.current{
  border-color: rgba(34,211,238,0.55);
  box-shadow: 0 0 34px rgba(34,211,238,0.10);
}

.ladder-item.current::after{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius: 14px;
  padding: 2px;
  background: linear-gradient(120deg, rgba(34,211,238,0.95), rgba(56,189,248,0.0), rgba(34,211,238,0.75));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  opacity: .55;
  filter: drop-shadow(0 0 14px rgba(34,211,238,0.25));
  pointer-events:none;
}

.badge{
  width: 38px;
  height: 38px;
  border-radius: 12px;
  position:relative;
  overflow:hidden;
  box-shadow: 0 0 16px rgba(0,0,0,.35);
}

.badge::before{
  content:"";
  position:absolute;
  inset:-16px;
  background: conic-gradient(from 0deg, rgba(255,255,255,0.0), rgba(255,255,255,0.55), rgba(255,255,255,0.0));
  opacity:.25;
  animation: spin 7s linear infinite;
}

.meta .name{
  font-size: 14px;
  letter-spacing: 1px;
  font-weight: 700;
  color:#e5e7eb;
}

.meta .desc{
  margin-top: 2px;
  font-size: 12px;
  color:#9ca3af;
}

/* ====== BADGE COLORS (Neon identity) ====== */
.b-outcast   { background: radial-gradient(circle at 30% 30%, #ffb86b, #111827 55%, #020617 85%); box-shadow: 0 0 18px rgba(255,146,76,.35); }
.b-vanguard  { background: radial-gradient(circle at 30% 30%, #22d3ee, #0b1220 55%, #020617 85%); box-shadow: 0 0 18px rgba(34,211,238,.35); }
.b-sentinel  { background: radial-gradient(circle at 30% 30%, #38bdf8, #0b1220 55%, #020617 85%); box-shadow: 0 0 18px rgba(56,189,248,.35); }
.b-phantom   { background: radial-gradient(circle at 30% 30%, #a78bfa, #111827 55%, #020617 85%); box-shadow: 0 0 18px rgba(167,139,250,.35); }
.b-warlord   { background: radial-gradient(circle at 30% 30%, #fb7185, #111827 55%, #020617 85%); box-shadow: 0 0 18px rgba(251,113,133,.35); }
.b-archon    { background: radial-gradient(circle at 30% 30%, #fbbf24, #111827 55%, #020617 85%); box-shadow: 0 0 18px rgba(251,191,36,.35); }
.b-overseer  { background: radial-gradient(circle at 30% 30%, #2dd4bf, #0b1220 55%, #020617 85%); box-shadow: 0 0 18px rgba(45,212,191,.35); }
.b-ascendant { background: radial-gradient(circle at 30% 30%, #60a5fa, #0b1220 55%, #020617 85%); box-shadow: 0 0 18px rgba(96,165,250,.35); }
.b-paragon   { background: radial-gradient(circle at 30% 30%, #e5e7eb, #111827 55%, #020617 85%); box-shadow: 0 0 18px rgba(229,231,235,.25); }
.b-nexus     { background: radial-gradient(circle at 30% 30%, #ff3b3b, #0b0f1a 55%, #020617 85%); box-shadow: 0 0 22px rgba(255,59,59,.40); }

.ladder-item.nexus{
  border-color: rgba(255,59,59,0.25);
}

/* ====== GLOBAL ====== */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', sans-serif;
}

body {
  background: radial-gradient(circle at top, #0b0f1a, #05070d);
  color: #e5e7eb;
  min-height: 100vh;
}

/* ====== NAV BAR ====== */
.navbar {
  display: flex;
  justify-content: center;
  gap: 30px;
  padding: 20px;
  background: linear-gradient(180deg, #0f172a, #020617);
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.nav-btn {
  background: transparent;
  border: none;
  color: #9ca3af;
  font-size: 15px;
  letter-spacing: 1px;
  cursor: pointer;
  padding: 10px 20px;
  position: relative;
  transition: color 0.3s;
}

.nav-btn:hover { color: #38bdf8; }
.nav-btn.active { color: #22d3ee; }

.nav-btn.active::after {
  content: '';
  position: absolute;
  bottom: -6px;
  left: 50%;
  transform: translateX(-50%);
  width: 40%;
  height: 2px;
  background: linear-gradient(90deg, #22d3ee, #38bdf8);
  box-shadow: 0 0 12px #22d3ee;
}

/* ====== CONTENT ====== */
.section {
  display: none;
  padding: 50px;
  animation: fade 0.4s ease;
}
.section.active { display: block; }

@keyframes fade {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ====== HEADERS ====== */
h1 {
  font-size: 32px;
  margin-bottom: 10px;
  background: linear-gradient(90deg, #22d3ee, #38bdf8);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

p { color: #9ca3af; }

/* ====== PANELS ====== */
.panel {
  margin-top: 30px;
  background: linear-gradient(180deg, #0f172a, #020617);
  border: 1px solid rgba(255,255,255,0.05);
  border-radius: 14px;
  padding: 25px;
  box-shadow: 0 0 25px rgba(34,211,238,0.05);
}

/* ====== RANK CARD (BASE) ====== */
.rank-card {
  margin-top: 40px;
  display: flex;
  align-items: center;
  gap: 30px;
  padding: 30px;
  background: linear-gradient(135deg, #020617, #0f172a);
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.06);
  box-shadow: 0 0 40px rgba(56,189,248,0.15);
  max-width: 700px;

  position: relative;
  overflow: hidden;
  transition: transform 0.25s ease;
}

.rank-card:hover { transform: translateY(-2px); }

.rank-icon {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  position: relative;
  overflow: hidden;
  box-shadow: 0 0 25px rgba(34,211,238,0.8);
  background: radial-gradient(circle at 30% 30%, #6affff, #0ea5e9 45%, #020617 70%);
}

.rank-glow {
  position: absolute;
  inset: -20px;
  background: conic-gradient(from 0deg, transparent, #38bdf8, transparent);
  animation: spin 6s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

.rank-info h2 {
  font-size: 28px;
  letter-spacing: 1px;
  margin-bottom: 8px;
  background: linear-gradient(90deg, #38bdf8, #22d3ee);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.rank-rp { font-size: 14px; color: #9ca3af; }

/* ====== RP BAR ====== */
.rp-bar {
  margin-top: 14px;
  width: 100%;
  height: 12px;
  background: #020617;
  border-radius: 10px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.08);
}

.rp-fill {
  height: 100%;
  background: linear-gradient(90deg, #22d3ee, #38bdf8, #0ea5e9);
  box-shadow: 0 0 12px #38bdf8;
  transition: width 0.5s ease;
}

/* ====== CHIP ====== */
.chip{
  display:inline-block;
  margin-top:10px;
  padding:6px 10px;
  font-size:12px;
  letter-spacing:1px;
  color:#a5f3fc;
  border:1px solid rgba(34,211,238,0.35);
  border-radius:999px;
  background: rgba(2,6,23,0.55);
  box-shadow: 0 0 14px rgba(34,211,238,0.15);
}

/* ====== RANK CARD GAME FX ====== */
.rank-bg {
  position: absolute;
  inset: -40px;
  background:
    radial-gradient(circle at 20% 30%, rgba(34,211,238,0.25), transparent 55%),
    radial-gradient(circle at 80% 70%, rgba(56,189,248,0.18), transparent 60%),
    radial-gradient(circle at 50% 50%, rgba(14,165,233,0.12), transparent 65%);
  filter: blur(12px);
  animation: bgFloat 8s ease-in-out infinite;
  z-index: 0;
}

@keyframes bgFloat {
  0% { transform: translate(0,0) scale(1); }
  50% { transform: translate(12px,-8px) scale(1.03); }
  100% { transform: translate(0,0) scale(1); }
}

.rank-noise {
  position: absolute;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='260' height='260'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='260' height='260' filter='url(%23n)' opacity='.18'/%3E%3C/svg%3E");
  opacity: 0.12;
  mix-blend-mode: overlay;
  z-index: 1;
}

.rank-card::after {
  content: "";
  position: absolute;
  inset: -2px;
  border-radius: 18px;
  padding: 2px;
  background: linear-gradient(120deg, rgba(34,211,238,0.9), rgba(56,189,248,0.0), rgba(34,211,238,0.7));
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  opacity: 0.55;
  filter: drop-shadow(0 0 18px rgba(34,211,238,0.35));
  animation: edgePulse 3.2s ease-in-out infinite;
  z-index: 2;
}

@keyframes edgePulse {
  0%, 100% { opacity: 0.35; }
  50% { opacity: 0.75; }
}

/* make inner content above effects */
.rank-icon, .rank-info { position: relative; z-index: 3; }

.rank-icon::before {
  content: "";
  position: absolute;
  inset: -18px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(34,211,238,0.35), transparent 65%);
  filter: blur(10px);
  opacity: 0.9;
}

.rank-icon::after {
  content: "";
  position: absolute;
  inset: 10px;
  border-radius: 50%;
  background: radial-gradient(circle at 25% 25%, rgba(255,255,255,0.35), transparent 55%);
  opacity: 0.7;
}
</style>
</head>

<body>

<!-- NAVIGATION -->
<div class="navbar">
  <button class="nav-btn active" onclick="showTab('dashboard', this)">DASHBOARD</button>
  <button class="nav-btn" onclick="showTab('rank', this)">RANK</button>
  <button class="nav-btn" onclick="showTab('history', this)">MATCH HISTORY</button>
  <button class="nav-btn" onclick="showTab('add', this)">ADD MATCH</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="section active">
  <h1>Player Dashboard</h1>
  <p>Overview of your ranked progress.</p>

  <div class="panel">
    <p>üîπ Current RP: <strong>1250</strong></p>
    <p>üîπ Current Rank: <strong>PHANTOM II</strong></p>
    <p>üîπ Win Streak: <strong>3</strong></p>
  </div>
</div>

<!-- RANK -->
<div id="rank" class="section">
  <h1>Competitive Rank</h1>
  <p>Your current competitive standing.</p>

  <!-- RANK CARD -->
  <div class="rank-card">
    <div class="rank-bg"></div>
    <div class="rank-noise"></div>

    <div class="rank-icon">
      <div class="rank-glow"></div>
    </div>

    <div class="rank-info">
      <h2>PHANTOM II</h2>
      <span class="rank-rp">RP: 1250 / 1500</span>
      <div class="chip">NEON ASCENSION</div>

      <div class="rp-bar">
        <div class="rp-fill" style="width: 83%;"></div>
      </div>
    </div>
  </div>

  <!-- RANK LADDER (OUTSIDE rank-card) -->
  <div class="ladder">
    <div class="ladder-head">
      <h3>Rank Ladder</h3>
      <span class="ladder-note">Locked ranks are dimmed. Current rank is highlighted.</span>
    </div>

    <div class="ladder-list">
      <div class="ladder-item unlocked">
        <div class="badge b-outcast"></div>
        <div class="meta">
          <div class="name">OUTCAST</div>
          <div class="desc">Chaos-born survivors.</div>
        </div>
      </div>

      <div class="ladder-item unlocked">
        <div class="badge b-vanguard"></div>
        <div class="meta">
          <div class="name">VANGUARD</div>
          <div class="desc">Rising force.</div>
        </div>
      </div>

      <div class="ladder-item unlocked">
        <div class="badge b-sentinel"></div>
        <div class="meta">
          <div class="name">SENTINEL</div>
          <div class="desc">Control & discipline.</div>
        </div>
      </div>

      <div class="ladder-item unlocked current">
        <div class="badge b-phantom"></div>
        <div class="meta">
          <div class="name">PHANTOM</div>
          <div class="desc">Precision mastery.</div>
        </div>
      </div>

      <div class="ladder-item locked">
        <div class="badge b-warlord"></div>
        <div class="meta">
          <div class="name">WARLORD</div>
          <div class="desc">Aggressive dominance.</div>
        </div>
      </div>

      <div class="ladder-item locked">
        <div class="badge b-archon"></div>
        <div class="meta">
          <div class="name">ARCHON</div>
          <div class="desc">Authority.</div>
        </div>
      </div>

      <div class="ladder-item locked">
        <div class="badge b-overseer"></div>
        <div class="meta">
          <div class="name">OVERSEER</div>
          <div class="desc">Vision & tactics.</div>
        </div>
      </div>

      <div class="ladder-item locked">
        <div class="badge b-ascendant"></div>
        <div class="meta">
          <div class="name">ASCENDANT</div>
          <div class="desc">Transcendence.</div>
        </div>
      </div>

      <div class="ladder-item locked">
        <div class="badge b-paragon"></div>
        <div class="meta">
          <div class="name">PARAGON</div>
          <div class="desc">Elite standard.</div>
        </div>
      </div>

      <div class="ladder-item locked nexus">
        <div class="badge b-nexus"></div>
        <div class="meta">
          <div class="name">NEXUS</div>
          <div class="desc">Absolute peak.</div>
        </div>
      </div>
    </div>
  </div>
</div>

  
<!-- ADD MATCH -->
<div id="add" class="section">
  <h1>Add Match</h1>
  <p>Enter your match results. Everything updates automatically.</p>

  <div class="panel form">
    <div class="grid">
      <label>üèÜ Place (1‚Äì25)
        <input id="inPlace" type="number" min="1" max="25" value="10">
      </label>

      <label>üî´ Kills
        <input id="inKills" type="number" min="0" value="0">
      </label>

      <label>ü§ù Assists
        <input id="inAssists" type="number" min="0" value="0">
      </label>

      <label>üíÄ Deaths
        <input id="inDeaths" type="number" min="0" value="1">
      </label>
    </div>

    <div class="toggles">
      <label class="toggle">
        <input id="inMVP" type="checkbox">
        <span>‚≠ê MVP</span>
      </label>

      <label class="toggle">
        <input id="inLeft" type="checkbox">
        <span>‚ö† Teammate Left</span>
      </label>
    </div>

    <div class="actions">
      <button class="btn" onclick="submitMatch()">Submit Match</button>
      <button class="btn" onclick="undoLastMatch()">Undo Last Match</button>
      <button class="btn ghost" onclick="resetMatches()">Reset All Data</button>
      <div class="hint">Data is stored locally in your browser.</div>
    </div>
    <div class="panel" style="margin-top:16px;">
  <h3 style="margin-bottom:10px; letter-spacing:.6px;">Export / Import</h3>
  <p style="color:#9ca3af; font-size:12px; margin-bottom:10px;">
    Backup your matches as JSON, or import them on another device.
  </p>

  <textarea id="ioBox" rows="8" style="
    width:100%;
    resize:vertical;
    padding:12px;
    border-radius:12px;
    border:1px solid rgba(255,255,255,0.08);
    background:rgba(2,6,23,0.55);
    color:#e5e7eb;
    outline:none;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
    font-size:12px;
    line-height:1.4;
  " placeholder="Paste JSON here (Import) or click Export to generate..."></textarea>

  <div class="actions" style="margin-top:10px;">
    <button class="btn" onclick="exportData()">Export JSON</button>
    <button class="btn" onclick="importData()">Import JSON</button>
    <button class="btn ghost" onclick="clearIO()">Clear Box</button>
  </div>

  <div class="hint">Tip: Export copies JSON to clipboard automatically.</div>
</div>
  </div>
</div>

<!-- HISTORY -->
<div id="history" class="section">
  <h1>Match History</h1>
  <p>Your recent ranked matches and RP changes.</p>

  <div class="history-top">
    <div class="mini-card">
      <div class="mini-label">Win Streak</div>
      <div class="mini-value" id="streakValue">0</div>
    </div>
    <div class="mini-card">
      <div class="mini-label">Best Match</div>
      <div class="mini-value" id="bestValue">+0</div>
    </div>
    <div class="mini-card">
      <div class="mini-label">Worst Match</div>
      <div class="mini-value" id="worstValue">0</div>
    </div>
  </div>

  <div class="match-list" id="matchList"></div>
</div>

<!-- CINEMATIC OVERLAY -->
<div id="cinematic" class="cinematic hidden">
  <div class="cinematic-bg"></div>
  <div class="cin-particles" id="cinParticles"></div>
 
  <div class="cin-wrap">
  <div class="cinematic-card">
    <div class="cinematic-title" id="cinTitle">RANK PROMOTED</div>
    <div class="cinematic-sub" id="cinSub">SENTINEL II ‚Üí PHANTOM III</div>

    <div class="cinematic-emblem">
      <div class="cin-ring"></div>
      <div class="cin-core"></div>
    </div>

    <div class="cin-hint">Click or press ESC</div>
   </div>
  </div>
</div>

<script>
/* ===== NAV ===== */
function showTab(tabId, btn) {
  var sections = document.querySelectorAll(".section");
  for (var i = 0; i < sections.length; i++) sections[i].classList.remove("active");

  var buttons = document.querySelectorAll(".nav-btn");
  for (var j = 0; j < buttons.length; j++) buttons[j].classList.remove("active");

  var target = document.getElementById(tabId);
  if (target) target.classList.add("active");
  if (btn) btn.classList.add("active");
}

/* ===== STORAGE ===== */
var STORAGE_KEY = "bf6_ranked_matches_v1";

function loadMatches() {
  try {
    var raw = localStorage.getItem(STORAGE_KEY);
    return raw ? JSON.parse(raw) : [];
  } catch (e) {
    return [];
  }
}

function saveMatches(matches) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(matches));
}

/* ===== RP TABLE ===== */
var placementRP = {
  1:100, 2:92, 3:85, 4:78, 5:70,
  6:60, 7:52, 8:45, 9:38, 10:30,
  11:20, 12:12, 13:6, 14:2, 15:0,
  16:-8, 17:-16, 18:-24, 19:-32, 20:-40,
  21:-48, 22:-54, 23:-58, 24:-59, 25:-60
};

function calcRPBreakdown(m) {
  var place = Math.min(25, Math.max(1, m.place));
  var base = (placementRP[place] !== undefined) ? placementRP[place] : 0;

  var killsBase = Math.min(m.kills, 10) * 4;
  var killsExtra = Math.max(0, m.kills - 10) * 2;
  var kills = killsBase + killsExtra;

  var assists = m.assists * 2;

  var deaths = m.deaths * -3;
  var earlyPenalty = (place > 15 && m.deaths > 0) ? -10 : 0;

  var mvp = m.mvp ? 15 : 0;
  var leftBonus = m.left ? 10 : 0;

  var total = base + kills + assists + deaths + earlyPenalty + mvp + leftBonus;
  total = Math.max(-80, Math.min(200, total));
  total = Math.round(total);

  return {
    place: place,
    base: base,
    kills: kills,
    assists: assists,
    deaths: deaths,
    earlyPenalty: earlyPenalty,
    mvp: mvp,
    leftBonus: leftBonus,
    total: total
  };
}


/* ===== RANKS ===== */
// Settings
var START_RP = 1250;
var MIN_RP = 0;

var rankTiers = [
  { name: "OUTCAST",  color: "#ffb86b", min: 0 },
  { name: "VANGUARD", color: "#22d3ee", min: 600 },
  { name: "SENTINEL", color: "#38bdf8", min: 1200 },
  { name: "PHANTOM",  color: "#a78bfa", min: 2000 },
  { name: "WARLORD",  color: "#fb7185", min: 3000 },
  { name: "ARCHON",   color: "#fbbf24", min: 4200 },
  { name: "OVERSEER", color: "#2dd4bf", min: 5400 },
  { name: "ASCENDANT",color: "#60a5fa", min: 6800 },
  { name: "PARAGON",  color: "#e5e7eb", min: 8500 },
  { name: "NEXUS",    color: "#ff3b3b", min: 10500 }
];

// cinematic tracking (tier + division)
var lastRankState = null; // { tierIndex, divIndex, label }

function getRank(totalRP) {
  var tierIndex = 0;
  for (var i = 0; i < rankTiers.length; i++) {
    if (totalRP >= rankTiers[i].min) tierIndex = i;
  }

  var tier = rankTiers[tierIndex];

  if (tier.name === "NEXUS") {
    return {
      label: "NEXUS",
      tierName: "NEXUS",
      tierIndex: tierIndex,
      div: null,
      divIndex: null,
      color: tier.color,
      rr: 100,
      nextMin: null
    };
  }

  var nextTier = rankTiers[tierIndex + 1];
  var tierSpan = (nextTier ? nextTier.min : (tier.min + 1000)) - tier.min;

  var progress = Math.max(0, Math.min(0.999, (totalRP - tier.min) / tierSpan));

  var div = "III";
  var divIndex = 0;

  if (progress < (1 / 3)) {
    div = "III"; divIndex = 0;
  } else if (progress < (2 / 3)) {
    div = "II"; divIndex = 1;
  } else {
    div = "I"; divIndex = 2;
  }

  var rr = Math.round(progress * 100);
  var label = tier.name + " " + div;

  return {
    label: label,
    tierName: tier.name,
    tierIndex: tierIndex,
    div: div,
    divIndex: divIndex,
    color: tier.color,
    rr: rr,
    nextMin: nextTier ? nextTier.min : null
  };
}

/* ===== CINEMATIC ===== */
function hideCinematic() {
  var el = document.getElementById("cinematic");
  if (el) el.classList.add("hidden");
}

function showCinematic(fromRank, toRank, isPromotion) {
  var el = document.getElementById("cinematic");
  var title = document.getElementById("cinTitle");
  var sub = document.getElementById("cinSub");
  if (!el || !title || !sub) return;

  var mode = isPromotion ? "up" : "down";
  el.dataset.mode = mode;

  title.textContent = isPromotion ? "RANK PROMOTED" : "RANK DEMOTED";
  sub.textContent = String(fromRank) + " ‚Üí " + String(toRank);

  el.classList.remove("hidden");

  // Auto-hide (kept simple)
  if (window.__cinT) clearTimeout(window.__cinT);
  window.__cinT = setTimeout(function () {
    el.classList.add("hidden");
  }, 2400);
}

// Close only on backdrop/root click + ESC
document.addEventListener("keydown", function (e) {
  if (e.key === "Escape") hideCinematic();
});

var cinRoot = document.getElementById("cinematic");
if (cinRoot) {
  cinRoot.addEventListener("click", function (e) {
    var t = e.target;
    var isBg = t && t.classList && t.classList.contains("cinematic-bg");
    var isRoot = t === cinRoot;
    if (isBg || isRoot) hideCinematic();
  });
}

/* ===== LADDER UI ===== */
function updateLadderUI(currentTierIndex) {
  var items = document.querySelectorAll(".ladder-list .ladder-item");
  for (var i = 0; i < items.length; i++) {
    var item = items[i];
    item.classList.remove("locked", "unlocked", "current");

    if (i < currentTierIndex) item.classList.add("unlocked");
    else if (i === currentTierIndex) item.classList.add("unlocked", "current");
    else item.classList.add("locked");
  }
}

/* ===== UI UPDATES ===== */
function updateRankUI(matches) {
  var sum = 0;
  for (var i = 0; i < matches.length; i++) sum += matches[i].rp;

  var totalRP = START_RP + sum;
  if (totalRP < MIN_RP) totalRP = MIN_RP;

  var rank = getRank(totalRP);

  var rankTitle = document.querySelector("#rank .rank-info h2");
  var rankRP = document.querySelector("#rank .rank-rp");
  var rpFill = document.querySelector("#rank .rp-fill");

  if (rankTitle) rankTitle.textContent = rank.label;
  if (rankRP) rankRP.textContent = rank.nextMin ? ("RP: " + totalRP + " / " + rank.nextMin) : ("RP: " + totalRP + " (MAX)");
  if (rpFill) rpFill.style.width = String(rank.rr) + "%";

  updateLadderUI(rank.tierIndex);

  // Dashboard
  var dash = document.querySelector("#dashboard .panel");
  if (dash) {
    dash.innerHTML =
      "<p>üîπ Current RP: <strong>" + totalRP + "</strong></p>" +
      "<p>üîπ Current Rank: <strong>" + rank.label + "</strong></p>" +
      "<p>üîπ Matches: <strong>" + matches.length + "</strong></p>";
  }

  // CINEMATIC trigger (tier + division)
  var currentState = { tierIndex: rank.tierIndex, divIndex: rank.divIndex, label: rank.label };

  if (lastRankState === null) {
    lastRankState = currentState;
  } else {
    var tierChanged = currentState.tierIndex !== lastRankState.tierIndex;
    var divChanged = currentState.divIndex !== lastRankState.divIndex;

    if (tierChanged) {
      var promotedTier = currentState.tierIndex > lastRankState.tierIndex;
      showCinematic(lastRankState.label, currentState.label, promotedTier);
      lastRankState = currentState;
    } else if (divChanged) {
      var a = (currentState.divIndex === null || currentState.divIndex === undefined) ? 0 : currentState.divIndex;
      var b = (lastRankState.divIndex === null || lastRankState.divIndex === undefined) ? 0 : lastRankState.divIndex;
      var promotedDiv = a > b;
      showCinematic(lastRankState.label, currentState.label, promotedDiv);
      lastRankState = currentState;
    }
  }
}

function renderHistoryFromStorage() {
  var matches = loadMatches();
  // Backfill breakdown for old saved matches (compatibility)
  var changed = false;
  for (var bi = 0; bi < matches.length; bi++) {
    if (!matches[bi].breakdown) {
      matches[bi].breakdown = calcRPBreakdown(matches[bi]);
      matches[bi].rp = matches[bi].breakdown.total;
      changed = true;
    }
  }
  if (changed) saveMatches(matches);
  updateRankUI(matches);

  var list = document.getElementById("matchList");
  if (!list) return;
  list.innerHTML = "";

  var streakEl = document.getElementById("streakValue");
  var bestEl = document.getElementById("bestValue");
  var worstEl = document.getElementById("worstValue");

  if (matches.length === 0) {
    var panel = document.createElement("div");
    panel.className = "panel";
    var p = document.createElement("p");
    p.innerHTML = 'No matches yet. Add your first match in <b>ADD MATCH</b>.';
    panel.appendChild(p);
    list.appendChild(panel);

    if (streakEl) streakEl.textContent = "0";
    if (bestEl) bestEl.textContent = "+0";
    if (worstEl) worstEl.textContent = "0";
    return;
  }

  var best = -Infinity;
  var worst = Infinity;
  for (var i = 0; i < matches.length; i++) {
    if (matches[i].rp > best) best = matches[i].rp;
    if (matches[i].rp < worst) worst = matches[i].rp;
  }

  if (bestEl) bestEl.textContent = best >= 0 ? ("+" + best) : String(best);
  if (worstEl) worstEl.textContent = String(worst);

  var streak = 0;
  for (var k = matches.length - 1; k >= 0; k--) {
    if (matches[k].place <= 3) streak++;
    else break;
  }
  if (streakEl) streakEl.textContent = String(streak);

  for (var idx = 0; idx < matches.length; idx++) {
    var m = matches[idx];

    var card = document.createElement("div");
    card.className = "match-card";
    if (m.rp === best) card.classList.add("best");
    if (m.rp === worst) card.classList.add("worst");

    var row = document.createElement("div");
    row.className = "match-row";

    var left = document.createElement("div");
    left.className = "left";

    var title = document.createElement("div");
    title.className = "title";

    var matchNum = document.createElement("span");
    matchNum.textContent = "Match #" + (idx + 1);
    title.appendChild(matchNum);

    var badges = document.createElement("div");
    badges.className = "badges";

    if (m.mvp) {
      var b1 = document.createElement("span");
      b1.className = "badge-pill badge-mvp";
      b1.textContent = "‚≠ê MVP";
      badges.appendChild(b1);
    }
    if (m.left) {
      var b2 = document.createElement("span");
      b2.className = "badge-pill badge-leave";
      b2.textContent = "‚ö† Teammate Left";
      badges.appendChild(b2);
    }

    title.appendChild(badges);

    var place = document.createElement("div");
    place.className = "place";
    place.innerHTML = "üèÜ Place: <strong>" + m.place + "</strong> / 25";

    var kad = document.createElement("div");
    kad.className = "kad";
    kad.innerHTML = "üî´ K/A/D: <strong>" + m.kills + "</strong> / <strong>" + m.assists + "</strong> / <strong>" + m.deaths + "</strong>";
    var bd = m.breakdown ? m.breakdown : calcRPBreakdown(m);

    function fmt(val) {
      var sign = val >= 0 ? "+" : "";
      return sign + String(val);
    }
    function cls(val) {
      return val >= 0 ? "pos" : "neg";
    }

    var breakdown = document.createElement("div");
    breakdown.className = "breakdown";

    var r1 = document.createElement("div");
    r1.className = "break-row";
    r1.innerHTML = "<span>Placement</span><strong class='" + cls(bd.base) + "'>" + fmt(bd.base) + "</strong>";

    var r2 = document.createElement("div");
    r2.className = "break-row";
    r2.innerHTML = "<span>Kills</span><strong class='" + cls(bd.kills) + "'>" + fmt(bd.kills) + "</strong>";

    var r3 = document.createElement("div");
    r3.className = "break-row";
    r3.innerHTML = "<span>Assists</span><strong class='" + cls(bd.assists) + "'>" + fmt(bd.assists) + "</strong>";

    var r4 = document.createElement("div");
    r4.className = "break-row";
    r4.innerHTML = "<span>Deaths</span><strong class='" + cls(bd.deaths) + "'>" + fmt(bd.deaths) + "</strong>";

    var r5 = document.createElement("div");
    r5.className = "break-row";
    r5.innerHTML = "<span>Early penalty</span><strong class='" + cls(bd.earlyPenalty) + "'>" + fmt(bd.earlyPenalty) + "</strong>";

    var r6 = document.createElement("div");
    r6.className = "break-row";
    r6.innerHTML = "<span>MVP</span><strong class='" + cls(bd.mvp) + "'>" + fmt(bd.mvp) + "</strong>";

    var r7 = document.createElement("div");
    r7.className = "break-row";
    r7.innerHTML = "<span>Teammate left</span><strong class='" + cls(bd.leftBonus) + "'>" + fmt(bd.leftBonus) + "</strong>";

    var totalRow = document.createElement("div");
    totalRow.className = "break-total";
    totalRow.innerHTML = "<strong>Total</strong><span class='" + cls(bd.total) + "'>" + fmt(bd.total) + " RP</span>";

    breakdown.appendChild(r1);
    breakdown.appendChild(r2);
    breakdown.appendChild(r3);
    breakdown.appendChild(r4);
    breakdown.appendChild(r5);
    breakdown.appendChild(r6);
    breakdown.appendChild(r7);
    breakdown.appendChild(totalRow);

    left.appendChild(title);
    left.appendChild(place);
    left.appendChild(kad);
    left.appendChild(breakdown);

    var rpDelta = document.createElement("div");
    rpDelta.className = "rpDelta " + (m.rp >= 0 ? "rpPlus" : "rpMinus");
    rpDelta.textContent = (m.rp >= 0 ? "+" + m.rp : String(m.rp)) + " RP";

    row.appendChild(left);
    row.appendChild(rpDelta);

    card.appendChild(row);
    list.appendChild(card);
  }
}

/* ===== ACTIONS ===== */
function submitMatch() {
  var place = Number(document.getElementById("inPlace").value);
  var kills = Number(document.getElementById("inKills").value);
  var assists = Number(document.getElementById("inAssists").value);
  var deaths = Number(document.getElementById("inDeaths").value);
  var mvp = document.getElementById("inMVP").checked;
  var left = document.getElementById("inLeft").checked;

  var match = { place: place, kills: kills, assists: assists, deaths: deaths, mvp: mvp, left: left, ts: Date.now() };
  match.breakdown = calcRPBreakdown(match);
  match.rp = match.breakdown.total;

  var matches = loadMatches();
  matches.push(match);
  saveMatches(matches);

  renderHistoryFromStorage();
  var btns = document.querySelectorAll(".nav-btn");
  showTab("history", btns[2]);
}
  function undoLastMatch() {
  var matches = loadMatches();
  if (!matches || matches.length === 0) {
    alert("No matches to undo.");
    return;
  }

  // Remove last match
  matches.pop();
  saveMatches(matches);

  // Reset cinematic state so it doesn't mis-trigger after undo
  lastRankState = null;

  renderHistoryFromStorage();

  // Optional: go to history tab to see the result
  var btns = document.querySelectorAll(".nav-btn");
  showTab("history", btns[2]);
}

  
function exportData() {
  var box = document.getElementById("ioBox");
  var matches = loadMatches();

  var payload = {
    version: 1,
    exportedAt: Date.now(),
    startRP: START_RP,
    matches: matches
  };

  var json = JSON.stringify(payload, null, 2);
  if (box) box.value = json;

  // Copy to clipboard (best effort)
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(json).then(function () {
      alert("Exported! JSON copied to clipboard.");
    }).catch(function () {
      alert("Exported! (Clipboard copy was blocked by browser.)");
    });
  } else {
    alert("Exported! (Clipboard API not available.)");
  }
}

function importData() {
  var box = document.getElementById("ioBox");
  if (!box) {
    alert("Import box not found.");
    return;
  }

  var text = String(box.value || "").trim();
  if (!text) {
    alert("Paste JSON into the box first.");
    return;
  }

  var payload;
  try {
    payload = JSON.parse(text);
  } catch (e) {
    alert("Invalid JSON. Please check formatting.");
    return;
  }

  // Accept either {matches:[...]} or raw array [...]
  var matches = null;

  if (Array.isArray(payload)) {
    matches = payload;
  } else if (payload && Array.isArray(payload.matches)) {
    matches = payload.matches;
  }

  if (!matches) {
    alert("JSON must contain an array of matches or { matches: [...] }");
    return;
  }

  // Basic validation + backfill rp/breakdown
  var cleaned = [];
  for (var i = 0; i < matches.length; i++) {
    var m = matches[i] || {};

    // required numeric fields (fallback to 0)
    var place = Number(m.place || 0);
    var kills = Number(m.kills || 0);
    var assists = Number(m.assists || 0);
    var deaths = Number(m.deaths || 0);
    var mvp = !!m.mvp;
    var left = !!m.left;
    var ts = Number(m.ts || Date.now());

    // normalize constraints
    if (!isFinite(place)) place = 0;
    if (!isFinite(kills)) kills = 0;
    if (!isFinite(assists)) assists = 0;
    if (!isFinite(deaths)) deaths = 0;

    var obj = {
      place: place,
      kills: kills,
      assists: assists,
      deaths: deaths,
      mvp: mvp,
      left: left,
      ts: ts
    };

    obj.breakdown = calcRPBreakdown(obj);
    obj.rp = obj.breakdown.total;

    cleaned.push(obj);
  }

  if (!confirm("Import will replace your current saved data. Continue?")) return;

  saveMatches(cleaned);
  lastRankState = null;
  renderHistoryFromStorage();

  var btns = document.querySelectorAll(".nav-btn");
  showTab("history", btns[2]);

  alert("Import complete!");
}

function clearIO() {
  var box = document.getElementById("ioBox");
  if (box) box.value = "";
}
  
function resetMatches() {
  if (!confirm("Reset all saved matches?")) return;
  localStorage.removeItem(STORAGE_KEY);
  lastRankState = null;
  renderHistoryFromStorage();
}

/* ===== INIT ===== */
renderHistoryFromStorage();
</script>


</body>
</html>

