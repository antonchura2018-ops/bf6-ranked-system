<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Apex-style Badge Preview (Fullscreen, FPS-safe)</title>
  <style>
    :root{
      --bg:#070A12;
      --ink:#EAF2FF;
      --muted:#98A2B3;
      --accent:#01a7ef;
    }

    body{
      margin:0;
      background: radial-gradient(1200px 700px at 50% 10%, rgba(168,85,255,.10), transparent 60%),
                  radial-gradient(900px 500px at 70% 85%, rgba(35,243,255,.08), transparent 60%),
                  var(--bg);
      color:var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }

    /* ===== Preview UI ===== */
    .wrap{ max-width:1100px; margin:26px auto; padding:0 16px; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    button{
      padding:10px 14px; border-radius:12px;
      border:1px solid rgba(234,242,255,.18);
      background: rgba(255,255,255,.06);
      color:var(--ink); font-weight:800; cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    button:hover{ border-color: rgba(35,243,255,.35); }
    .pill{
      padding:8px 12px; border-radius:999px;
      border:1px solid rgba(234,242,255,.12);
      background: rgba(255,255,255,.04);
      color: rgba(234,242,255,.72);
      font-size:12px;
    }

    /* =========================================================
       FULLSCREEN OVERLAY (FPS-SAFE)
       ========================================================= */
    #award{
      position:fixed; inset:0; z-index:9999;
      display:grid; place-items:center;
      opacity:0; pointer-events:none;
      transition: opacity .18s ease;
    }
    #award.is-open{ opacity:1; pointer-events:auto; }

    .veil{
      position:absolute; inset:0;
      background:
        radial-gradient(900px 520px at 50% 42%,
          color-mix(in srgb, var(--accent) 18%, transparent),
          rgba(0,0,0,.88)
        ),
        radial-gradient(1200px 720px at 50% 10%,
          color-mix(in srgb, var(--accent) 10%, transparent),
          transparent 60%
        ),
        linear-gradient(180deg, rgba(0,0,0,.78), rgba(0,0,0,.92));
      opacity:0;
    }
    #award.is-open .veil{ animation: veilIn .26s ease forwards; }
    @keyframes veilIn{ to{ opacity:1; } }

    /* Minimal HUD (optional) */
    .hud{
      position:absolute; left:34px; right:34px; top:22px;
      display:flex; justify-content:space-between; gap:14px;
      pointer-events:none;
      opacity:.92;
    }
    .hud .left .kicker{
      font-size:12px; letter-spacing:.22em; text-transform:uppercase;
      color: rgba(234,242,255,.78);
    }
    .hud .left .sub{
      margin-top:8px;
      font-size:12px;
      color: rgba(152,162,179,.9);
      letter-spacing:.06em;
      max-width:560px;
    }
    .hud .right{
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      color: rgba(234,242,255,.66);
    }

    /* Center */
    .center{
      position:relative;
      width: min(920px, 96vw);
      height: min(820px, 86vh);
      display:grid;
      place-items:center;
      pointer-events:none;
      will-change: transform;
    }

    /* Backlight (NO blur) */
    .center::before{
      content:"";
      position:absolute;
      inset:-95%;
      background: radial-gradient(circle at 50% 50%,
        color-mix(in srgb, var(--accent) 18%, transparent),
        transparent 64%
      );
      opacity:1;
      filter:none;
      pointer-events:none;
    }

    /* Stack = badge + label centered together */
    .stack{
      position:relative;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap: 22px;
    }

    /* =========================================================
       FX LAYERS (FPS-SAFE): opacity + transform only
       ========================================================= */

    .impactFlash{
      position:absolute; inset:-30%;
      background:
        radial-gradient(closest-side at 50% 50%, rgba(255,255,255,.18), transparent 60%),
        radial-gradient(closest-side at 50% 50%, color-mix(in srgb, var(--accent) 18%, transparent), transparent 72%);
      opacity:0;
      transform: scale(.78);
      pointer-events:none;
      will-change: opacity, transform;
    }
    #award[data-phase="impact"] .impactFlash{
      animation: flash 520ms ease forwards;
    }
    @keyframes flash{
      0%{ opacity:0; transform: scale(.78); }
      35%{ opacity:1; transform: scale(1); }
      100%{ opacity:0; transform: scale(1.12); }
    }

    /* Core flash (Apex-like) */
    .coreFlash{
      position:absolute;
      width: 22vmin;
      height: 22vmin;
      border-radius:999px;
      opacity:0;
      pointer-events:none;
      background: radial-gradient(circle,
        rgba(255,255,255,.20),
        color-mix(in srgb, var(--accent) 22%, transparent),
        transparent 70%
      );
      transform: scale(.6);
      will-change: transform, opacity;
    }
    #award[data-phase="impact"] .coreFlash{
      animation: corePop 360ms ease forwards;
    }
    @keyframes corePop{
      0%{opacity:0; transform: scale(.55);}
      35%{opacity:1; transform: scale(1.05);}
      100%{opacity:0; transform: scale(1.35);}
    }

    /* Creation glow burst */
    .creationGlow{
      position:absolute;
      inset:-140%;
      border-radius:999px;
      pointer-events:none;
      opacity:0;
      transform: scale(.18);
      will-change: transform, opacity;
      background:
        radial-gradient(circle at 50% 50%,
          rgba(255,255,255,.12) 0%,
          color-mix(in srgb, var(--accent) 22%, transparent) 20%,
          color-mix(in srgb, var(--accent) 12%, transparent) 40%,
          transparent 64%
        );
    }
    #award[data-phase="reveal"] .creationGlow{
      animation: cgPop 1150ms cubic-bezier(.12,.95,.18,1) forwards;
    }
    @keyframes cgPop{
      0%   { opacity:0; transform: scale(.18); }
      18%  { opacity:1; transform: scale(.52); }
      100% { opacity:0; transform: scale(1.55); }
    }

    /* Wing creation: two side glows expanding outward */
    .wingWave{
      position:absolute;
      inset:-110%;
      border-radius:999px;
      pointer-events:none;
      opacity:0;
      transform: scale(.55);
      will-change: transform, opacity;
      background:
        radial-gradient(circle at 18% 52%,
          color-mix(in srgb, var(--accent) 40%, transparent) 0%,
          transparent 40%
        ),
        radial-gradient(circle at 82% 52%,
          color-mix(in srgb, var(--accent) 40%, transparent) 0%,
          transparent 40%
        );
    }
    #award[data-phase="reveal"] .wingWave{
      animation: wwPop 1050ms cubic-bezier(.12,.95,.18,1) forwards;
    }
    @keyframes wwPop{
      0%   { opacity:0; transform: scale(.52); }
      20%  { opacity:.95; transform: scale(.82); }
      100% { opacity:0; transform: scale(1.40); }
    }

    /* Sparks (no blur) */
    .sparks{
      position:absolute;
      inset:-35%;
      opacity:0;
      pointer-events:none;
      background:
        radial-gradient(circle at 20% 30%, color-mix(in srgb, var(--accent) 18%, transparent), transparent 38%),
        radial-gradient(circle at 70% 55%, color-mix(in srgb, var(--accent) 14%, transparent), transparent 40%),
        radial-gradient(circle at 55% 25%, rgba(255,255,255,.08), transparent 34%),
        radial-gradient(circle at 35% 70%, color-mix(in srgb, var(--accent) 12%, transparent), transparent 42%);
      transform: scale(.98);
      will-change: opacity, transform;
    }
    #award[data-phase="open"] .sparks{ animation: sparksOpen 900ms ease forwards; }
    #award[data-phase="reveal"] .sparks{ animation: sparksReveal 1200ms ease forwards; }
    @keyframes sparksOpen{
      0%{ opacity:0; transform: scale(.96); }
      35%{ opacity:.55; }
      100%{ opacity:.08; transform: scale(1.06); }
    }
    @keyframes sparksReveal{
      0%{ opacity:.06; transform: scale(1.00); }
      35%{ opacity:.45; transform: scale(1.10); }
      100%{ opacity:0; transform: scale(1.16); }
    }

    /* Falling particles (no blur) */
    .falling{
      position:absolute;
      inset:-20%;
      opacity:0;
      pointer-events:none;
      background:
        radial-gradient(circle, rgba(255,255,255,.10) 1px, transparent 2px) 0 0/ 90px 90px,
        radial-gradient(circle, color-mix(in srgb, var(--accent) 16%, transparent) 1px, transparent 2px) 20px 30px/ 120px 120px,
        radial-gradient(circle, color-mix(in srgb, var(--accent) 12%, transparent) 1px, transparent 2px) 40px 10px/ 150px 150px;
      transform: translateY(-40px);
      will-change: transform, opacity;
    }
    #award[data-phase="open"] .falling,
    #award[data-phase="impact"] .falling,
    #award[data-phase="reveal"] .falling,
    #award[data-phase="done"] .falling{
      opacity:.50;
      animation: fallingMove 2.8s linear infinite;
    }
    @keyframes fallingMove{
      from{ transform: translateY(-40px); }
      to{ transform: translateY(140px); }
    }

    /* Micro zoom on impact (short) */
    #award[data-phase="impact"] .center{
      animation: microZoom 300ms ease forwards;
    }
    @keyframes microZoom{
      0%{ transform: scale(1); }
      30%{ transform: scale(1.015); }
      100%{ transform: scale(1); }
    }

    /* =========================================================
       BADGE (ONE IMAGE + slices)
       ========================================================= */
    .rankBadge{
      position:relative;
      width: min(760px, 92vw);
      height: min(760px, 92vw);
      display:grid;
      place-items:center;
      transform: translateY(0) scale(1);
      opacity: 1;
      will-change: transform, opacity;
      --badge-url: url("assets/ranks/eidolon.webp");
    }

    .rankBadge__img{
      width: min(600px, 82vw);
      height: min(600px, 82vw);
      background: var(--badge-url) center/contain no-repeat;
      filter: drop-shadow(0 0 18px rgba(0,0,0,.35));
      opacity:0; /* visible after assembly */
    }

    /* 4 slices */
    .slice{
      position:absolute;
      inset: 8%;
      background: var(--badge-url) center/contain no-repeat;
      opacity:0;
      will-change: transform, opacity;
    }
    .slice.s1{ clip-path: polygon(0 0, 50% 0, 50% 50%, 0 50%); }
    .slice.s2{ clip-path: polygon(50% 0, 100% 0, 100% 50%, 50% 50%); }
    .slice.s3{ clip-path: polygon(0 50%, 50% 50%, 50% 100%, 0 100%); }
    .slice.s4{ clip-path: polygon(50% 50%, 100% 50%, 100% 100%, 50% 100%); }

    #award[data-phase="open"] .slice{ animation: sliceIn 900ms cubic-bezier(.2,.9,.2,1) forwards; }
    #award[data-phase="open"] .slice.s1{ transform: translate(-70px,-70px) scale(.92); }
    #award[data-phase="open"] .slice.s2{ transform: translate(70px,-70px) scale(.92); }
    #award[data-phase="open"] .slice.s3{ transform: translate(-70px,70px) scale(.92); }
    #award[data-phase="open"] .slice.s4{ transform: translate(70px,70px) scale(.92); }

    @keyframes sliceIn{
      0%{ opacity:0; }
      35%{ opacity:1; }
      100%{ opacity:1; transform: translate(0,0) scale(1); }
    }

    /* Show final image from impact to end; hide slices after impact */
    #award[data-phase="impact"] .rankBadge__img,
    #award[data-phase="reveal"] .rankBadge__img,
    #award[data-phase="done"] .rankBadge__img{ opacity:1; }

    #award[data-phase="impact"] .slice,
    #award[data-phase="reveal"] .slice,
    #award[data-phase="done"] .slice{ opacity:0; transition: opacity 120ms ease; }

    /* Halo (no blur) */
    .rankBadge__halo{
      position:absolute;
      inset:-28%;
      border-radius:999px;
      pointer-events:none;
      opacity:.18;
      transform: scale(1.02);
      will-change: transform, opacity;
      background:
        radial-gradient(closest-side, rgba(255,255,255,.06), transparent 62%),
        radial-gradient(closest-side, color-mix(in srgb, var(--accent) 16%, transparent), transparent 68%),
        conic-gradient(from 0deg,
          rgba(255,255,255,0) 0deg,
          color-mix(in srgb, var(--accent) 16%, transparent) 36deg,
          rgba(255,255,255,0) 120deg,
          color-mix(in srgb, var(--accent) 10%, transparent) 200deg,
          rgba(255,255,255,0) 360deg
        );
    }

    /* Tier strength */
    .rankBadge.tier-0 .rankBadge__halo{ opacity:.14; transform: scale(.98); }
    .rankBadge.tier-1 .rankBadge__halo{ opacity:.22; transform: scale(1.01); }
    .rankBadge.tier-2 .rankBadge__halo{ opacity:.32; transform: scale(1.04); }
    .rankBadge.is-top .rankBadge__halo{ opacity:.40; transform: scale(1.06); }

    /* Impact halo burst */
    #award[data-phase="impact"] .rankBadge__halo{
      animation: haloBurst 560ms ease forwards;
    }
    @keyframes haloBurst{
      0%{ opacity: .22; transform: scale(1.02); }
      35%{ opacity: .85; transform: scale(1.10) rotate(8deg); }
      100%{ opacity: .28; transform: scale(1.05) rotate(0deg); }
    }

    /* Idle glow in done */
    #award[data-phase="done"] .rankBadge__halo{
      animation: haloIdle 1.9s ease-in-out infinite;
    }
    @keyframes haloIdle{
      0%,100%{ opacity:.24; transform: scale(1.03); }
      50%{ opacity:.42; transform: scale(1.08); }
    }

    /* Badge pop */
    .rankBadge.anim-up{ animation: badgePop 820ms cubic-bezier(.12,.95,.18,1) forwards; }
    @keyframes badgePop{
      0%{ transform: translateY(6px) scale(.98); }
      35%{ transform: translateY(-8px) scale(1.07); }
      100%{ transform: translateY(0) scale(1); }
    }

    /* =========================================================
       LABEL (centered in stack)
       ========================================================= */
    .label{
      opacity:0;
      text-align:center;
      width: min(900px, 92vw);
    }
    .labelTop{
      font-size:13px;
      letter-spacing:.22em;
      text-transform:uppercase;
      color: rgba(234,242,255,.78);
    }
    .labelName{
      margin-top:8px;
      font-size:34px;
      font-weight:900;
      letter-spacing:.20em;
      text-transform:uppercase;
      color: rgba(234,242,255,.92);
      text-shadow: 0 0 16px rgba(255,255,255,.10);
    }

    #award.is-tierup .label{ display:none; }

    #award.is-rankup[data-phase="reveal"] .label,
    #award.is-rankup[data-phase="done"] .label{
      opacity:1;
      animation: labelIn 620ms cubic-bezier(.2,.9,.2,1) forwards;
    }
    @keyframes labelIn{
      from{ opacity:0; transform: translateY(8px); }
      to{ opacity:1; transform: translateY(0); }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      #award[data-phase="impact"] .impactFlash,
      #award[data-phase="impact"] .coreFlash,
      #award[data-phase="impact"] .center,
      #award[data-phase="reveal"] .creationGlow,
      #award[data-phase="reveal"] .wingWave,
      #award[data-phase="open"] .slice,
      #award[data-phase="open"] .sparks,
      #award[data-phase="reveal"] .sparks,
      #award[data-phase="open"] .falling,
      #award[data-phase="impact"] .falling,
      #award[data-phase="reveal"] .falling,
      #award[data-phase="done"] .falling,
      #award[data-phase="done"] .rankBadge__halo,
      .rankBadge.anim-up{
        animation:none !important;
      }
      .label{ opacity:1; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h2>Apex-style Badge Preview (Fullscreen, FPS-safe)</h2>
    <div class="row">
      <button id="btnTierUp">Tier Up (III→II→I)</button>
      <button id="btnRankUp">Rank Up</button>
      <button id="btnTop">Top Rank (EIDOLON)</button>
      <button id="btnClose">Close</button>
      <span class="pill">Allowed FX • centered • auto-close</span>
    </div>
    <p style="opacity:.78;margin-top:12px;line-height:1.45">
      Мета: як в Apex — бейдж еволюціонує шарами (без лагів). Центрований бейдж + текст + glow + wing burst + particles.
    </p>
  </div>

  <div id="award" aria-hidden="true">
    <div class="veil"></div>

    <div class="hud">
      <div class="left">
        <div class="kicker">RANKED UPDATE</div>
        <div class="sub" id="subText">Apex-style evolution • Confirmed.</div>
      </div>
      <div class="right" id="rightText">AUTO</div>
    </div>

    <div class="center">
      <div class="impactFlash" aria-hidden="true"></div>
      <div class="coreFlash" aria-hidden="true"></div>
      <div class="creationGlow" aria-hidden="true"></div>
      <div class="wingWave" aria-hidden="true"></div>
      <div class="sparks" aria-hidden="true"></div>
      <div class="falling" aria-hidden="true"></div>

      <div class="stack">
        <div class="rankBadge tier-0 animated" id="badge">
          <div class="rankBadge__img" id="rankIcon" aria-hidden="true"></div>

          <div class="slice s1" aria-hidden="true"></div>
          <div class="slice s2" aria-hidden="true"></div>
          <div class="slice s3" aria-hidden="true"></div>
          <div class="slice s4" aria-hidden="true"></div>

          <span class="rankBadge__halo" aria-hidden="true"></span>
        </div>

        <div class="label" aria-hidden="true">
          <div class="labelTop" id="labelTop">NEW RANK</div>
          <div class="labelName" id="labelName">EIDOLON</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const award = document.getElementById('award');
    const badge = document.getElementById('badge');
    const subText = document.getElementById('subText');
    const rightText = document.getElementById('rightText');
    const labelTop = document.getElementById('labelTop');
    const labelName = document.getElementById('labelName');

    let timers = [];
    const clearTimers = ()=>{ timers.forEach(t=>clearTimeout(t)); timers=[]; };

    const ACCENT_BY_RANK = {
      eidolon:"#d61830",
      seraph:"#d9f9e8",
      monarch:"#c7336c",
      overlord:"#8c4826",
      archon:"#01a7ef",
      reaper:"#9bb1f6",
      harbinger:"#a6b1b9",
      marauder:"#fef525",
      thrall:"#60eb89",
      outcast:"#0f0f13",
    };

    // Tiny SFX (no external files)
    let audioCtx = null;
    function beep(kind='impact'){
      try{
        if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const t0 = audioCtx.currentTime;
        const o = audioCtx.createOscillator();
        const g = audioCtx.createGain();
        o.type = 'sine';

        const base = kind === 'impact' ? 220 : 520;
        o.frequency.setValueAtTime(base, t0);
        o.frequency.exponentialRampToValueAtTime(base * (kind === 'impact' ? 3.0 : 1.6), t0 + 0.08);

        g.gain.setValueAtTime(0.0001, t0);
        g.gain.exponentialRampToValueAtTime(kind === 'impact' ? 0.10 : 0.07, t0 + 0.02);
        g.gain.exponentialRampToValueAtTime(0.0001, t0 + 0.18);

        o.connect(g); g.connect(audioCtx.destination);
        o.start(t0);
        o.stop(t0 + 0.22);
      }catch(e){}
    }

    function openOverlay(mode){
      clearTimers();
      award.classList.add('is-open');
      award.setAttribute('aria-hidden','false');

      award.classList.toggle('is-tierup', mode === 'tierUp');
      award.classList.toggle('is-rankup', mode === 'rankUp');
      award.classList.remove('is-top');
      award.dataset.phase = 'open';

      badge.classList.remove('anim-up');
      void badge.offsetWidth;
    }

    function closeOverlay(){
      clearTimers();
      award.classList.remove('is-open','is-tierup','is-rankup','is-top');
      award.removeAttribute('data-phase');
      award.setAttribute('aria-hidden','true');
    }

    function setTierClass(divIndex){
      badge.classList.remove('tier-0','tier-1','tier-2');
      badge.classList.add(`tier-${Math.max(0, Math.min(2, divIndex))}`);
    }

    function setBadge(iconSrc){
      if(iconSrc) badge.style.setProperty('--badge-url', `url("${iconSrc}")`);
    }

    function playTierUp({rankName, iconSrc, divIndex, accentColor="#01a7ef"}){
      openOverlay('tierUp');
      award.style.setProperty('--accent', accentColor);

      subText.textContent = 'Division upgrade • Apex-style evolution.';
      rightText.textContent = 'AUTO';
      labelTop.textContent = 'DIVISION UP';
      labelName.textContent = rankName;

      setBadge(iconSrc);
      setTierClass(divIndex);

      badge.classList.add('anim-up');

      timers.push(setTimeout(()=>{ award.dataset.phase='impact'; beep('impact'); }, 900));
      timers.push(setTimeout(()=>{ award.dataset.phase='reveal'; beep('up'); }, 1350));
      timers.push(setTimeout(()=>{ award.dataset.phase='done'; }, 3000));
      timers.push(setTimeout(closeOverlay, 3000 + 2000));
    }

    function playRankUp({rankName, iconSrc, isTop=false, accentColor="#23f3ff"}){
      openOverlay('rankUp');
      award.style.setProperty('--accent', accentColor);
      award.classList.toggle('is-top', !!isTop);

      subText.textContent = isTop ? 'Top rank achieved • Reward state active.' : 'Promotion confirmed • Award unlocked.';
      rightText.textContent = 'AUTO';
      labelTop.textContent = 'NEW RANK';
      labelName.textContent = rankName;

      setBadge(iconSrc);
      setTierClass(0);
      badge.classList.add('anim-up');

      timers.push(setTimeout(()=>{ award.dataset.phase='impact'; beep('impact'); }, 1050));
      timers.push(setTimeout(()=>{ award.dataset.phase='reveal'; beep('up'); }, 1300));
      timers.push(setTimeout(()=>{ award.dataset.phase='done'; }, 2150));

      const hold = isTop ? 3200 : 2600;
      timers.push(setTimeout(closeOverlay, 2150 + hold));
    }

    // Buttons
    let divIndex = 0;
    document.getElementById('btnTierUp').addEventListener('click', ()=>{
      divIndex = Math.min(2, divIndex + 1);
      playTierUp({
        rankName: 'REAPER',
        iconSrc: 'assets/ranks/reaper.webp',
        divIndex,
        accentColor: ACCENT_BY_RANK.reaper
      });
    });

    document.getElementById('btnRankUp').addEventListener('click', ()=>{
      divIndex = 0;
      playRankUp({
        rankName: 'ARCHON',
        iconSrc: 'assets/ranks/archon.webp',
        isTop: false,
        accentColor: ACCENT_BY_RANK.archon
      });
    });

    document.getElementById('btnTop').addEventListener('click', ()=>{
      playRankUp({
        rankName: 'EIDOLON',
        iconSrc: 'assets/ranks/eidolon.webp',
        isTop: true,
        accentColor: ACCENT_BY_RANK.eidolon
      });
    });

    document.getElementById('btnClose').addEventListener('click', closeOverlay);
    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && award.classList.contains('is-open')) closeOverlay();
    });
  </script>
</body>
</html>
